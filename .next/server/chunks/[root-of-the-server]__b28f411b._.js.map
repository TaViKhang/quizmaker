{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///F:/Github%20Project/quizmaker/my-project/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\ndeclare global {\n  var prisma: PrismaClient | undefined;\n}\n\nexport const db = globalThis.prisma || new PrismaClient();\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = db;\n"],"names":[],"mappings":";;;AAAA;;AAMO,MAAM,KAAK,WAAW,MAAM,IAAI,IAAI,6HAAA,CAAA,eAAY;AAEvD,wCAA2C,WAAW,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file:///F:/Github%20Project/quizmaker/my-project/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { AuthOptions } from \"next-auth\"\nimport { PrismaAdapter } from \"@auth/prisma-adapter\"\nimport { db } from \"@/lib/db\"\nimport GoogleProvider from \"next-auth/providers/google\"\nimport { ROLES, RoleType } from \"@/lib/constants\"\n\n// Domain email được ủy quyền cao hơn\nconst AUTHORIZED_TEACHER_DOMAINS = ['school.edu', 'university.edu', 'teacher.org']\n\n// Fix cho type adapter\nconst prismaAdapter = PrismaAdapter(db) as any\n\n// Cải thiện error handling\nconst handleAuthError = (error: any, context: string) => {\n  console.error(`[Auth Error] ${context}:`, error);\n  return false;\n}\n\nexport const authOptions: AuthOptions = {\n  adapter: prismaAdapter,\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n      allowDangerousEmailAccountLinking: true,\n    }),\n  ],\n  session: {\n    strategy: \"jwt\",\n    maxAge: 24 * 60 * 60, // 24 hours\n    updateAge: 4 * 60 * 60, // 4 hours\n  },\n  callbacks: {\n    async jwt({ token, user, account, profile, trigger }) {\n      try {\n        // Trường hợp đăng nhập - Chỉ cập nhật token khi có user từ đăng nhập\n        if (user) {\n          // Đảm bảo role có thể null\n          token.role = user.role as RoleType | null;\n          token.id = user.id;\n          return token;\n        }\n        \n        // Trường hợp trigger update - Cập nhật token khi có sự thay đổi rõ ràng\n        if (trigger === 'update' && token?.sub) {\n          try {\n            const dbUser = await db.user.findUnique({\n              where: { id: token.sub },\n              select: { \n                id: true, \n                name: true, \n                email: true, \n                role: true, \n                image: true \n              }\n            });\n            \n            if (dbUser) {\n              // Cập nhật token với giá trị mới\n              token.role = dbUser.role as RoleType | null;\n              token.name = dbUser.name;\n              token.email = dbUser.email;\n              token.picture = dbUser.image;\n              \n              // Thêm timestamp để đảm bảo không cache token cũ\n              token.updatedAt = Date.now();\n            }\n          } catch (error) {\n            console.error(\"Error updating token:\", error);\n          }\n          return token;\n        }\n        \n        // Trường hợp token từ session: kiểm tra nếu cần cập nhật\n        if (token?.sub && (!token.role || !token.updatedAt || Date.now() - (token.updatedAt as number || 0) > 60 * 1000)) {\n          try {\n            const dbUser = await db.user.findUnique({\n              where: { id: token.sub },\n              select: { role: true }\n            });\n            \n            if (dbUser) {\n              token.role = dbUser.role as RoleType | null;\n              token.updatedAt = Date.now();\n            }\n          } catch (error) {\n            console.error(\"Error refreshing token:\", error);\n          }\n        }\n        \n        return token;\n      } catch (error) {\n        console.error(\"JWT callback error:\", error);\n        return token;\n      }\n    },\n    async session({ session, token }) {\n      try {\n        if (session.user && token) {\n          // Đảm bảo role có thể null\n          session.user.role = token.role as RoleType | null;\n          session.user.id = token.id as string;\n        }\n        return session;\n      } catch (error) {\n        console.error(\"Session callback error:\", error);\n        return session;\n      }\n    },\n    async signIn({ user, account, profile }) {\n      // Nếu user có email\n      if (user?.email) {\n        try {\n          // Kiểm tra user đã tồn tại chưa\n          const existingUser = await db.user.findUnique({\n            where: { email: user.email },\n          })\n          \n          if (!existingUser) {\n            // Tạo user mới không có role (null) để người dùng chọn sau\n            await db.user.create({\n              data: {\n                id: user.id,\n                email: user.email,\n                name: user.name,\n                image: user.image,\n                role: null, // Không thiết lập role mặc định\n              },\n            })\n            \n            // Đánh dấu để redirect tới trang chọn role\n            return true\n          }\n          \n          return true\n        } catch (error) {\n          return handleAuthError(error, \"signIn callback\");\n        }\n      }\n      \n      return true\n    }\n  },\n  pages: {\n    signIn: '/auth/signin',\n    signOut: '/',\n    error: '/auth/error',\n    newUser: '/auth/select-role' // Điều hướng người dùng mới đến trang chọn role\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n  debug: process.env.NODE_ENV === \"development\",\n  logger: {\n    error(code, ...message) {\n      console.error(`[NextAuth Error] ${code}:`, ...message);\n    },\n    warn(code, ...message) {\n      if (process.env.NODE_ENV === \"development\") {\n        console.warn(`[NextAuth Warning] ${code}:`, ...message);\n      }\n    },\n    debug(code, ...message) {\n      if (process.env.NODE_ENV === \"development\") {\n        console.debug(`[NextAuth Debug] ${code}:`, ...message);\n      }\n    },\n  },\n}\n\nconst handler = NextAuth(authOptions)\nexport { handler as GET, handler as POST }\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 350, "column": 0}, "map": {"version":3,"sources":["file:///F:/Github%20Project/quizmaker/my-project/lib/api-response.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { ZodError } from \"zod\";\n\n/**\n * Standard response structure for paginated data\n */\nexport interface PaginatedResponseData<T> {\n  success: boolean;\n  data: {\n    items: T[];\n    pagination: {\n      total: number;\n      page: number;\n      limit: number;\n      totalPages: number;\n    };\n  };\n  meta?: Record<string, any>;\n}\n\n/**\n * Standard response structure for single item data\n */\nexport interface SingleResponseData<T> {\n  success: boolean;\n  data: T;\n  meta?: Record<string, any>;\n}\n\n/**\n * Standard error response structure\n */\nexport interface ErrorResponseData {\n  success: boolean;\n  error: {\n    code: string;\n    message: string;\n    details?: any;\n  };\n}\n\n/**\n * Create a successful response with pagination\n */\nexport function createPaginatedResponse<T>(\n  data: T[],\n  total: number,\n  page: number,\n  limit: number,\n  meta?: Record<string, any>,\n  headers?: HeadersInit\n): NextResponse {\n  const response: PaginatedResponseData<T> = {\n    success: true,\n    data: {\n      items: data,\n      pagination: {\n        total,\n        page,\n        limit,\n        totalPages: Math.ceil(total / limit)\n      }\n    }\n  };\n\n  if (meta) {\n    response.meta = meta;\n  }\n\n  return NextResponse.json(response, { headers });\n}\n\n/**\n * Create a successful response for a single item\n */\nexport function createSuccessResponse<T>(\n  data: T,\n  status: number = 200,\n  meta?: Record<string, any>,\n  headers?: HeadersInit\n): NextResponse {\n  const response: SingleResponseData<T> = { \n    success: true,\n    data \n  };\n  \n  if (meta) {\n    response.meta = meta;\n  }\n  \n  return NextResponse.json(response, { status, headers });\n}\n\n/**\n * Create an error response\n */\nexport function createErrorResponse(\n  code: string,\n  message: string,\n  details?: any,\n  status: number = 400\n): NextResponse {\n  const response: ErrorResponseData = {\n    success: false,\n    error: {\n      code,\n      message\n    }\n  };\n  \n  if (details) {\n    response.error.details = details;\n  }\n  \n  return NextResponse.json(response, { status });\n}\n\n/**\n * Format Zod validation errors\n */\nexport function formatZodError(error: ZodError) {\n  return {\n    code: \"VALIDATION_ERROR\",\n    message: \"Invalid input data\",\n    details: error.errors.map(err => ({\n      path: err.path.join('.'),\n      message: err.message\n    }))\n  };\n}\n\n/**\n * Create an authenticated error response (401)\n */\nexport function createAuthenticationError(): NextResponse {\n  return createErrorResponse(\n    \"UNAUTHENTICATED\",\n    \"You must be logged in to access this resource\",\n    undefined,\n    401\n  );\n}\n\n/**\n * Create a permission error response (403)\n */\nexport function createPermissionError(message: string = \"You don't have permission to access this resource\"): NextResponse {\n  return createErrorResponse(\n    \"UNAUTHORIZED\", \n    message,\n    undefined,\n    403\n  );\n}\n\n/**\n * Create a not found error response (404)\n */\nexport function createNotFoundError(resource: string = \"Resource\"): NextResponse {\n  return createErrorResponse(\n    \"NOT_FOUND\",\n    `${resource} not found`,\n    undefined,\n    404\n  );\n}\n\n/**\n * Create a server error response (500)\n */\nexport function createServerError(error?: Error): NextResponse {\n  console.error(\"Server error:\", error);\n  \n  return createErrorResponse(\n    \"SERVER_ERROR\",\n    \"An unexpected error occurred\",\n    process.env.NODE_ENV === 'development' ? error?.message : undefined,\n    500\n  );\n}\n\n/**\n * Create a validation error response (400)\n */\nexport function createValidationError(details?: any): NextResponse {\n  return createErrorResponse(\n    \"VALIDATION_ERROR\",\n    \"Invalid input data\",\n    details,\n    400\n  );\n} "],"names":[],"mappings":";;;;;;;;;;;AAAA;;AA4CO,SAAS,wBACd,IAAS,EACT,KAAa,EACb,IAAY,EACZ,KAAa,EACb,IAA0B,EAC1B,OAAqB;IAErB,MAAM,WAAqC;QACzC,SAAS;QACT,MAAM;YACJ,OAAO;YACP,YAAY;gBACV;gBACA;gBACA;gBACA,YAAY,KAAK,IAAI,CAAC,QAAQ;YAChC;QACF;IACF;IAEA,IAAI,MAAM;QACR,SAAS,IAAI,GAAG;IAClB;IAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,UAAU;QAAE;IAAQ;AAC/C;AAKO,SAAS,sBACd,IAAO,EACP,SAAiB,GAAG,EACpB,IAA0B,EAC1B,OAAqB;IAErB,MAAM,WAAkC;QACtC,SAAS;QACT;IACF;IAEA,IAAI,MAAM;QACR,SAAS,IAAI,GAAG;IAClB;IAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,UAAU;QAAE;QAAQ;IAAQ;AACvD;AAKO,SAAS,oBACd,IAAY,EACZ,OAAe,EACf,OAAa,EACb,SAAiB,GAAG;IAEpB,MAAM,WAA8B;QAClC,SAAS;QACT,OAAO;YACL;YACA;QACF;IACF;IAEA,IAAI,SAAS;QACX,SAAS,KAAK,CAAC,OAAO,GAAG;IAC3B;IAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,UAAU;QAAE;IAAO;AAC9C;AAKO,SAAS,eAAe,KAAe;IAC5C,OAAO;QACL,MAAM;QACN,SAAS;QACT,SAAS,MAAM,MAAM,CAAC,GAAG,CAAC,CAAA,MAAO,CAAC;gBAChC,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC;gBACpB,SAAS,IAAI,OAAO;YACtB,CAAC;IACH;AACF;AAKO,SAAS;IACd,OAAO,oBACL,mBACA,iDACA,WACA;AAEJ;AAKO,SAAS,sBAAsB,UAAkB,mDAAmD;IACzG,OAAO,oBACL,gBACA,SACA,WACA;AAEJ;AAKO,SAAS,oBAAoB,WAAmB,UAAU;IAC/D,OAAO,oBACL,aACA,GAAG,SAAS,UAAU,CAAC,EACvB,WACA;AAEJ;AAKO,SAAS,kBAAkB,KAAa;IAC7C,QAAQ,KAAK,CAAC,iBAAiB;IAE/B,OAAO,oBACL,gBACA,gCACA,uCAAyC,OAAO,gDAChD;AAEJ;AAKO,SAAS,sBAAsB,OAAa;IACjD,OAAO,oBACL,oBACA,sBACA,SACA;AAEJ","debugId":null}},
    {"offset": {"line": 443, "column": 0}, "map": {"version":3,"sources":["file:///F:/Github%20Project/quizmaker/my-project/app/api/classes/%5Bid%5D/dashboard/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/app/api/auth/[...nextauth]/route\";\nimport { db } from \"@/lib/db\";\nimport { Role, ClassType } from \"@prisma/client\";\nimport { \n  createSuccessResponse, \n  createErrorResponse, \n  createAuthenticationError,\n  createPermissionError,\n  createNotFoundError,\n  createServerError\n} from \"@/lib/api-response\";\n\n// GET handler for class dashboard summary\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return createAuthenticationError();\n    }\n    \n    const awaitedParams = await params; // Await params\n    const classId = awaitedParams.id;\n    \n    // Get basic class information\n    const classItem = await db.class.findUnique({\n      where: { id: classId },\n      select: {\n        id: true,\n        name: true,\n        description: true,\n        subject: true,\n        type: true,\n        coverImage: true,\n        teacherId: true,\n        teacher: {\n          select: {\n            id: true,\n            name: true,\n            image: true,\n          }\n        },\n        students: {\n          select: {\n            studentId: true,\n          }\n        }\n      }\n    });\n    \n    if (!classItem) {\n      return createNotFoundError(\"Class not found\");\n    }\n    \n    // Different data for students vs teachers\n    if (session.user.role === Role.TEACHER) {\n      // Ensure the teacher is the owner of the class\n      if (classItem.teacherId !== session.user.id) {\n        return createPermissionError(\"You don't have access to this class dashboard\");\n      }\n      \n      // Get teacher-specific dashboard data\n      const [studentCount, quizCount, materialCount, announcementCount, recentEnrollments] = await Promise.all([\n        // Student count\n        db.classEnrollment.count({\n          where: { classId }\n        }),\n        \n        // Quiz count\n        db.quiz.count({\n          where: { classId }\n        }),\n        \n        // Material count\n        db.material.count({\n          where: { classId }\n        }),\n        \n        // Announcement count\n        db.classAnnouncement.count({\n          where: { classId }\n        }),\n        \n        // Recent enrollments\n        db.classEnrollment.findMany({\n          where: { classId },\n          orderBy: { joinedAt: 'desc' },\n          take: 5,\n          include: {\n            student: {\n              select: {\n                id: true,\n                name: true,\n                email: true,\n                image: true\n              }\n            }\n          }\n        })\n      ]);\n      \n      // Get recent quizzes\n      const recentQuizzes = await db.quiz.findMany({\n        where: { classId },\n        orderBy: { createdAt: 'desc' },\n        take: 5,\n        select: {\n          id: true,\n          title: true,\n          startDate: true,\n          endDate: true,\n          isPublished: true,\n          _count: {\n            select: {\n              attempts: true\n            }\n          }\n        }\n      });\n      \n      return createSuccessResponse({\n        class: {\n          id: classItem.id,\n          name: classItem.name,\n          description: classItem.description,\n          subject: classItem.subject,\n          coverImage: classItem.coverImage\n        },\n        teacher: classItem.teacher,\n        stats: {\n          studentCount,\n          quizCount,\n          materialCount,\n          announcementCount\n        },\n        recentActivity: {\n          enrollments: recentEnrollments.map(enrollment => ({\n            id: enrollment.id,\n            student: enrollment.student,\n            joinedAt: enrollment.joinedAt\n          })),\n          quizzes: recentQuizzes.map(quiz => ({\n            id: quiz.id,\n            title: quiz.title,\n            startDate: quiz.startDate,\n            endDate: quiz.endDate,\n            isPublished: quiz.isPublished,\n            attemptCount: quiz._count.attempts\n          }))\n        }\n      });\n      \n    } else if (session.user.role === Role.STUDENT) {\n      // Check if student is enrolled in this class\n      const enrollment = await db.classEnrollment.findFirst({\n        where: {\n          classId,\n          studentId: session.user.id\n        }\n      });\n      \n      const isPublic = classItem.type === ClassType.PUBLIC;\n      \n      // Students can only access classes they're enrolled in or public classes\n      if (!enrollment && !isPublic) {\n        return createPermissionError(\"You don't have access to this class dashboard\");\n      }\n      \n      // Get student-specific dashboard data\n      const [upcomingQuizzes, recentAnnouncements, materials, classmates] = await Promise.all([\n        // Upcoming quizzes\n        db.quiz.findMany({\n          where: {\n            classId,\n            isPublished: true,\n            isActive: true,\n            OR: [\n              // Upcoming quizzes (start date in the future)\n              {\n                startDate: {\n                  gt: new Date()\n                }\n              },\n              // Ongoing quizzes (started but not ended)\n              {\n                startDate: {\n                  lte: new Date()\n                },\n                endDate: {\n                  gte: new Date()\n                }\n              }\n            ]\n          },\n          orderBy: {\n            startDate: 'asc'\n          },\n          take: 5,\n          select: {\n            id: true,\n            title: true,\n            description: true,\n            startDate: true,\n            endDate: true,\n            timeLimit: true,\n            // Check if student has attempted this quiz\n            attempts: {\n              where: {\n                userId: session.user.id\n              },\n              select: {\n                id: true,\n                startedAt: true,\n                completedAt: true,\n                score: true\n              }\n            }\n          }\n        }),\n        \n        // Recent announcements\n        db.classAnnouncement.findMany({\n          where: { classId },\n          orderBy: { createdAt: 'desc' },\n          take: 5,\n          select: {\n            id: true,\n            title: true,\n            content: true,\n            createdAt: true\n          }\n        }),\n        \n        // Recent materials\n        db.material.findMany({\n          where: { classId },\n          orderBy: { createdAt: 'desc' },\n          take: 5,\n          select: {\n            id: true,\n            title: true,\n            type: true,\n            createdAt: true\n          }\n        }),\n        \n        // Classmates (if enrolled)\n        enrollment ? db.classEnrollment.findMany({\n          where: {\n            classId,\n            studentId: { not: session.user.id } // Exclude current student\n          },\n          take: 10,\n          include: {\n            student: {\n              select: {\n                id: true,\n                name: true,\n                image: true\n              }\n            }\n          }\n        }) : Promise.resolve([])\n      ]);\n      \n      // Format the quizzes to include hasAttempted flag\n      const formattedQuizzes = upcomingQuizzes.map(quiz => ({\n        id: quiz.id,\n        title: quiz.title,\n        description: quiz.description,\n        startDate: quiz.startDate,\n        endDate: quiz.endDate,\n        timeLimit: quiz.timeLimit,\n        status: getQuizStatus(quiz.startDate, quiz.endDate),\n        hasAttempted: quiz.attempts.length > 0,\n        attemptId: quiz.attempts[0]?.id || null,\n        attemptScore: quiz.attempts[0]?.score || null\n      }));\n      \n      return createSuccessResponse({\n        class: {\n          id: classItem.id,\n          name: classItem.name,\n          description: classItem.description,\n          subject: classItem.subject,\n          coverImage: classItem.coverImage\n        },\n        teacher: classItem.teacher,\n        enrollment: enrollment ? {\n          id: enrollment.id,\n          joinedAt: enrollment.joinedAt\n        } : null,\n        dashboard: {\n          upcomingQuizCount: formattedQuizzes.length,\n          recentAnnouncementCount: recentAnnouncements.length,\n          materialsCount: materials.length,\n          classmateCount: classmates.length\n        },\n        content: {\n          upcomingQuizzes: formattedQuizzes,\n          recentAnnouncements,\n          materials,\n          classmates: classmates.map(enrollment => ({\n            id: enrollment.student.id,\n            name: enrollment.student.name,\n            image: enrollment.student.image\n          }))\n        }\n      });\n    }\n    \n    // Should never get here due to Role enum\n    return createPermissionError(\"Invalid user role\");\n    \n  } catch (error) {\n    console.error(\"Error generating class dashboard:\", error);\n    return createServerError(error instanceof Error ? error : new Error(\"Unknown error\"));\n  }\n}\n\n// Helper to determine quiz status\nfunction getQuizStatus(startDate: Date | null, endDate: Date | null): 'upcoming' | 'ongoing' | 'ended' {\n  const now = new Date();\n  \n  if (startDate && startDate > now) {\n    return 'upcoming';\n  }\n  \n  if (endDate && endDate < now) {\n    return 'ended';\n  }\n  \n  return 'ongoing';\n} "],"names":[],"mappings":"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","debugId":null}}]
}
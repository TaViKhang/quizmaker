module.exports = {

"[project]/.next-internal/server/app/api/teacher/dashboard/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/@prisma/client [external] (@prisma/client, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@prisma/client", () => require("@prisma/client"));

module.exports = mod;
}}),
"[project]/lib/db.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "db": (()=>db)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
;
const db = globalThis.prisma || new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]();
if ("TURBOPACK compile-time truthy", 1) globalThis.prisma = db;
}}),
"[project]/lib/prisma.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "prisma": (()=>prisma)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/db.ts [app-route] (ecmascript)");
;
const prisma = __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"];
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/@prisma/client/runtime/library [external] (@prisma/client/runtime/library, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@prisma/client/runtime/library", () => require("@prisma/client/runtime/library"));

module.exports = mod;
}}),
"[project]/app/api/auth/[...nextauth]/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>handler),
    "POST": (()=>handler),
    "authOptions": (()=>authOptions)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@auth/prisma-adapter/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/db.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$google$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/providers/google.js [app-route] (ecmascript)");
;
;
;
;
// Domain email được ủy quyền cao hơn
const AUTHORIZED_TEACHER_DOMAINS = [
    'school.edu',
    'university.edu',
    'teacher.org'
];
// Fix cho type adapter
const prismaAdapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PrismaAdapter"])(__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"]);
// Cải thiện error handling
const handleAuthError = (error, context)=>{
    console.error(`[Auth Error] ${context}:`, error);
    return false;
};
const authOptions = {
    adapter: prismaAdapter,
    providers: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$google$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            clientId: process.env.GOOGLE_CLIENT_ID,
            clientSecret: process.env.GOOGLE_CLIENT_SECRET,
            allowDangerousEmailAccountLinking: true
        })
    ],
    session: {
        strategy: "jwt",
        maxAge: 24 * 60 * 60,
        updateAge: 4 * 60 * 60
    },
    callbacks: {
        async jwt ({ token, user, account, profile, trigger }) {
            try {
                // Trường hợp đăng nhập - Chỉ cập nhật token khi có user từ đăng nhập
                if (user) {
                    // Đảm bảo role có thể null
                    token.role = user.role;
                    token.id = user.id;
                    return token;
                }
                // Trường hợp trigger update - Cập nhật token khi có sự thay đổi rõ ràng
                if (trigger === 'update' && token?.sub) {
                    try {
                        const dbUser = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.findUnique({
                            where: {
                                id: token.sub
                            },
                            select: {
                                id: true,
                                name: true,
                                email: true,
                                role: true,
                                image: true
                            }
                        });
                        if (dbUser) {
                            // Cập nhật token với giá trị mới
                            token.role = dbUser.role;
                            token.name = dbUser.name;
                            token.email = dbUser.email;
                            token.picture = dbUser.image;
                            // Thêm timestamp để đảm bảo không cache token cũ
                            token.updatedAt = Date.now();
                        }
                    } catch (error) {
                        console.error("Error updating token:", error);
                    }
                    return token;
                }
                // Trường hợp token từ session: kiểm tra nếu cần cập nhật
                if (token?.sub && (!token.role || !token.updatedAt || Date.now() - (token.updatedAt || 0) > 60 * 1000)) {
                    try {
                        const dbUser = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.findUnique({
                            where: {
                                id: token.sub
                            },
                            select: {
                                role: true
                            }
                        });
                        if (dbUser) {
                            token.role = dbUser.role;
                            token.updatedAt = Date.now();
                        }
                    } catch (error) {
                        console.error("Error refreshing token:", error);
                    }
                }
                return token;
            } catch (error) {
                console.error("JWT callback error:", error);
                return token;
            }
        },
        async session ({ session, token }) {
            try {
                if (session.user && token) {
                    // Đảm bảo role có thể null
                    session.user.role = token.role;
                    session.user.id = token.id;
                }
                return session;
            } catch (error) {
                console.error("Session callback error:", error);
                return session;
            }
        },
        async signIn ({ user, account, profile }) {
            // Nếu user có email
            if (user?.email) {
                try {
                    // Kiểm tra user đã tồn tại chưa
                    const existingUser = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.findUnique({
                        where: {
                            email: user.email
                        }
                    });
                    if (!existingUser) {
                        // Tạo user mới không có role (null) để người dùng chọn sau
                        await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.create({
                            data: {
                                id: user.id,
                                email: user.email,
                                name: user.name,
                                image: user.image,
                                role: null
                            }
                        });
                        // Đánh dấu để redirect tới trang chọn role
                        return true;
                    }
                    return true;
                } catch (error) {
                    return handleAuthError(error, "signIn callback");
                }
            }
            return true;
        }
    },
    pages: {
        signIn: '/auth/signin',
        signOut: '/',
        error: '/auth/error',
        newUser: '/auth/select-role' // Điều hướng người dùng mới đến trang chọn role
    },
    secret: process.env.NEXTAUTH_SECRET,
    debug: ("TURBOPACK compile-time value", "development") === "development",
    logger: {
        error (code, ...message) {
            console.error(`[NextAuth Error] ${code}:`, ...message);
        },
        warn (code, ...message) {
            if ("TURBOPACK compile-time truthy", 1) {
                console.warn(`[NextAuth Warning] ${code}:`, ...message);
            }
        },
        debug (code, ...message) {
            if ("TURBOPACK compile-time truthy", 1) {
                console.debug(`[NextAuth Debug] ${code}:`, ...message);
            }
        }
    }
};
const handler = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(authOptions);
;
}}),
"[project]/lib/auth-middleware.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "requireAuth": (()=>requireAuth),
    "requireTeacherAttemptAccess": (()=>requireTeacherAttemptAccess),
    "requireTeacherClassAccess": (()=>requireTeacherClassAccess),
    "requireTeacherQuizAccess": (()=>requireTeacherQuizAccess),
    "requireTeacherRole": (()=>requireTeacherRole),
    "requireTeacherStudentAccess": (()=>requireTeacherStudentAccess),
    "withErrorHandling": (()=>withErrorHandling)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/next/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/api/auth/[...nextauth]/route.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/prisma.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
;
;
;
;
;
async function requireAuth() {
    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
    if (!session?.user) {
        throw new Response("Unauthorized", {
            status: 401
        });
    }
    return session;
}
async function requireTeacherRole() {
    const session = await requireAuth();
    if (session.user.role !== __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["Role"].TEACHER) {
        throw new Response("Forbidden: Teachers only", {
            status: 403
        });
    }
    return session;
}
async function requireTeacherClassAccess(classId) {
    const session = await requireTeacherRole();
    const classData = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].class.findUnique({
        where: {
            id: classId
        }
    });
    if (!classData) {
        throw new Response("Class not found", {
            status: 404
        });
    }
    if (classData.teacherId !== session.user.id) {
        throw new Response("Forbidden: You don't have access to this class", {
            status: 403
        });
    }
    return {
        session,
        classData
    };
}
async function requireTeacherStudentAccess(studentId) {
    const session = await requireTeacherRole();
    // Find classes taught by this teacher that have this student enrolled
    const studentEnrollments = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].classEnrollment.findMany({
        where: {
            studentId: studentId,
            class: {
                teacherId: session.user.id
            }
        },
        include: {
            class: true
        }
    });
    if (studentEnrollments.length === 0) {
        throw new Response("Forbidden: You don't have access to this student", {
            status: 403
        });
    }
    const student = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique({
        where: {
            id: studentId
        },
        select: {
            id: true,
            name: true,
            email: true,
            image: true
        }
    });
    if (!student) {
        throw new Response("Student not found", {
            status: 404
        });
    }
    const classes = studentEnrollments.map((enrollment)=>enrollment.class);
    return {
        session,
        student,
        classes
    };
}
async function requireTeacherQuizAccess(quizId) {
    const session = await requireTeacherRole();
    const quiz = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quiz.findUnique({
        where: {
            id: quizId
        }
    });
    if (!quiz) {
        throw new Response("Quiz not found", {
            status: 404
        });
    }
    if (quiz.authorId !== session.user.id) {
        throw new Response("Forbidden: You don't have access to this quiz", {
            status: 403
        });
    }
    return {
        session,
        quiz
    };
}
async function requireTeacherAttemptAccess(attemptId) {
    const session = await requireTeacherRole();
    const attempt = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quizAttempt.findUnique({
        where: {
            id: attemptId
        },
        include: {
            quiz: true
        }
    });
    if (!attempt) {
        throw new Response("Attempt not found", {
            status: 404
        });
    }
    if (attempt.quiz.authorId !== session.user.id) {
        throw new Response("Forbidden: You don't have access to this attempt", {
            status: 403
        });
    }
    return {
        session,
        attempt
    };
}
function withErrorHandling(handler) {
    return async (req, params)=>{
        try {
            return await handler(req, params);
        } catch (error) {
            console.error("API Error:", error);
            if (error instanceof Response) {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: error.statusText
                }, {
                    status: error.status
                });
            }
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Internal server error"
            }, {
                status: 500
            });
        }
    };
}
}}),
"[project]/app/api/teacher/dashboard/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>GET)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/prisma.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2d$middleware$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/auth-middleware.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/next/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/api/auth/[...nextauth]/route.ts [app-route] (ecmascript)");
;
;
;
;
const GET = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2d$middleware$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withErrorHandling"])(async (req)=>{
    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
    if (!session?.user || session.user.role !== "TEACHER") {
        return new Response("Unauthorized", {
            status: 401
        });
    }
    const teacherId = session.user.id;
    // Execute parallel queries for better performance
    const [activeClasses, totalStudents, activeQuizzes, completedQuizzes, studentEngagement, recentClasses, recentQuizzes, classPerformance, topPerformingStudents, upcomingDeadlines] = await Promise.all([
        // Count of active classes
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].class.count({
            where: {
                teacherId,
                isActive: true
            }
        }),
        // Count of unique students across all classes
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].classEnrollment.findMany({
            where: {
                class: {
                    teacherId
                }
            },
            select: {
                studentId: true
            }
        }).then((enrollments)=>new Set(enrollments.map((e)=>e.studentId)).size),
        // Count of active quizzes
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quiz.count({
            where: {
                authorId: teacherId,
                isActive: true,
                isPublished: true
            }
        }),
        // Count of completed quizzes
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quiz.count({
            where: {
                authorId: teacherId,
                isActive: false,
                isPublished: true
            }
        }),
        // Calculate student engagement rate
        Promise.resolve().then(async ()=>{
            const teacherQuizzes = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quiz.findMany({
                where: {
                    authorId: teacherId
                },
                select: {
                    id: true
                }
            });
            const quizIds = teacherQuizzes.map((q)=>q.id);
            // Count students who have taken quizzes
            const studentsWithAttempts = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quizAttempt.findMany({
                where: {
                    quizId: {
                        in: quizIds
                    }
                },
                select: {
                    userId: true
                },
                distinct: [
                    'userId'
                ]
            });
            const allStudents = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].classEnrollment.findMany({
                where: {
                    class: {
                        teacherId
                    }
                },
                select: {
                    studentId: true
                },
                distinct: [
                    'studentId'
                ]
            });
            const studentsWithAttemptsCount = studentsWithAttempts.length;
            const totalStudentsCount = allStudents.length;
            return totalStudentsCount > 0 ? Math.round(studentsWithAttemptsCount / totalStudentsCount * 100) : 0;
        }),
        // Most recently updated classes
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].class.findMany({
            where: {
                teacherId
            },
            orderBy: {
                updatedAt: 'desc'
            },
            take: 5,
            select: {
                id: true,
                name: true,
                subject: true,
                type: true,
                isActive: true,
                coverImage: true,
                updatedAt: true,
                _count: {
                    select: {
                        students: true
                    }
                }
            }
        }),
        // Most recently updated quizzes
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quiz.findMany({
            where: {
                authorId: teacherId
            },
            orderBy: {
                updatedAt: 'desc'
            },
            take: 5,
            select: {
                id: true,
                title: true,
                isActive: true,
                isPublished: true,
                category: true,
                updatedAt: true,
                _count: {
                    select: {
                        questions: true,
                        attempts: true
                    }
                },
                class: {
                    select: {
                        id: true,
                        name: true
                    }
                }
            }
        }),
        // Class performance data for charts
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].class.findMany({
            where: {
                teacherId
            },
            select: {
                id: true,
                name: true,
                students: {
                    select: {
                        student: {
                            select: {
                                id: true
                            }
                        }
                    }
                }
            }
        }).then(async (classes)=>{
            // Calculate average score for each class
            return Promise.all(classes.map(async (cls)=>{
                const studentIds = cls.students.map((s)=>s.student.id);
                if (studentIds.length === 0) {
                    return {
                        id: cls.id,
                        className: cls.name,
                        averageScore: 0,
                        studentCount: 0,
                        completionRate: 0
                    };
                }
                const attempts = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quizAttempt.findMany({
                    where: {
                        userId: {
                            in: studentIds
                        },
                        score: {
                            not: null
                        },
                        quiz: {
                            authorId: teacherId
                        }
                    },
                    select: {
                        score: true
                    }
                });
                const avgScore = attempts.length > 0 ? Math.round(attempts.reduce((sum, attempt)=>sum + (attempt.score || 0), 0) / attempts.length) : 0;
                return {
                    id: cls.id,
                    className: cls.name,
                    averageScore: avgScore,
                    studentCount: studentIds.length,
                    completionRate: Math.round(Math.random() * 100) // This would be calculated based on real data
                };
            }));
        }),
        // Top performing students across all classes
        Promise.resolve().then(async ()=>{
            const enrollments = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].classEnrollment.findMany({
                where: {
                    class: {
                        teacherId
                    }
                },
                select: {
                    studentId: true,
                    student: {
                        select: {
                            id: true,
                            name: true,
                            email: true,
                            image: true
                        }
                    }
                },
                distinct: [
                    'studentId'
                ]
            });
            const studentIds = enrollments.map((e)=>e.studentId);
            // Get average scores for each student
            const studentScores = await Promise.all(studentIds.map(async (studentId)=>{
                const attempts = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quizAttempt.findMany({
                    where: {
                        userId: studentId,
                        score: {
                            not: null
                        },
                        quiz: {
                            authorId: teacherId
                        }
                    },
                    select: {
                        score: true
                    }
                });
                const avgScore = attempts.length > 0 ? Math.round(attempts.reduce((sum, attempt)=>sum + (attempt.score || 0), 0) / attempts.length) : 0;
                const student = enrollments.find((e)=>e.studentId === studentId)?.student;
                return {
                    id: studentId,
                    name: student?.name || 'Unknown',
                    email: student?.email || '',
                    image: student?.image,
                    averageScore: avgScore,
                    attemptCount: attempts.length
                };
            }));
            // Sort by score and return top 5
            return studentScores.filter((s)=>s.attemptCount > 0).sort((a, b)=>b.averageScore - a.averageScore).slice(0, 5);
        }),
        // Upcoming quiz deadlines
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quiz.findMany({
            where: {
                authorId: teacherId,
                isActive: true,
                isPublished: true,
                endDate: {
                    gte: new Date()
                }
            },
            orderBy: {
                endDate: 'asc'
            },
            take: 5,
            select: {
                id: true,
                title: true,
                endDate: true,
                class: {
                    select: {
                        name: true
                    }
                }
            }
        })
    ]);
    // Calculate quiz category distribution
    const quizCategories = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].quiz.groupBy({
        by: [
            'category'
        ],
        where: {
            authorId: teacherId,
            category: {
                not: null
            }
        },
        _count: true
    });
    const categoryDistribution = quizCategories.map((item)=>({
            category: item.category || 'Uncategorized',
            count: item._count
        }));
    // Format activity feed - combine recent classes and quizzes updates
    const activityItems = [
        ...recentClasses.map((cls)=>({
                id: cls.id,
                type: 'class',
                title: cls.name,
                subject: cls.subject,
                date: cls.updatedAt,
                metadata: {
                    studentCount: cls._count.students,
                    isActive: cls.isActive
                }
            })),
        ...recentQuizzes.map((quiz)=>({
                id: quiz.id,
                type: 'quiz',
                title: quiz.title,
                subject: quiz.class?.name,
                date: quiz.updatedAt,
                metadata: {
                    questionCount: quiz._count.questions,
                    attemptCount: quiz._count.attempts,
                    isActive: quiz.isActive,
                    isPublished: quiz.isPublished
                }
            }))
    ].sort((a, b)=>new Date(b.date).getTime() - new Date(a.date).getTime()).slice(0, 10);
    return Response.json({
        overview: {
            activeClasses,
            totalStudents,
            activeQuizzes,
            completedQuizzes,
            engagementRate: studentEngagement
        },
        recentClasses: recentClasses.map((cls)=>({
                id: cls.id,
                name: cls.name,
                subject: cls.subject,
                type: cls.type,
                isActive: cls.isActive,
                studentCount: cls._count.students,
                coverImage: cls.coverImage,
                updatedAt: cls.updatedAt
            })),
        recentQuizzes: recentQuizzes.map((quiz)=>({
                id: quiz.id,
                title: quiz.title,
                isActive: quiz.isActive,
                isPublished: quiz.isPublished,
                category: quiz.category,
                questionCount: quiz._count.questions,
                attemptCount: quiz._count.attempts,
                className: quiz.class?.name || null,
                classId: quiz.class?.id || null,
                updatedAt: quiz.updatedAt
            })),
        classPerformance,
        activityFeed: activityItems,
        studentPerformance: topPerformingStudents,
        categoryDistribution,
        upcomingDeadlines
    });
});
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__c5c8b884._.js.map
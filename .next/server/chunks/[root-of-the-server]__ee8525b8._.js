module.exports = {

"[project]/.next-internal/server/app/api/users/me/upcoming-assessments/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/@prisma/client/runtime/library [external] (@prisma/client/runtime/library, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@prisma/client/runtime/library", () => require("@prisma/client/runtime/library"));

module.exports = mod;
}}),
"[externals]/@prisma/client [external] (@prisma/client, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@prisma/client", () => require("@prisma/client"));

module.exports = mod;
}}),
"[project]/lib/db.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "db": (()=>db)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
;
const db = globalThis.prisma || new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]();
if ("TURBOPACK compile-time truthy", 1) globalThis.prisma = db;
}}),
"[project]/app/api/auth/[...nextauth]/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>handler),
    "POST": (()=>handler),
    "authOptions": (()=>authOptions)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@auth/prisma-adapter/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/db.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$google$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/providers/google.js [app-route] (ecmascript)");
;
;
;
;
// Domain email được ủy quyền cao hơn
const AUTHORIZED_TEACHER_DOMAINS = [
    'school.edu',
    'university.edu',
    'teacher.org'
];
// Fix cho type adapter
const prismaAdapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PrismaAdapter"])(__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"]);
// Cải thiện error handling
const handleAuthError = (error, context)=>{
    console.error(`[Auth Error] ${context}:`, error);
    return false;
};
const authOptions = {
    adapter: prismaAdapter,
    providers: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$google$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            clientId: process.env.GOOGLE_CLIENT_ID,
            clientSecret: process.env.GOOGLE_CLIENT_SECRET,
            allowDangerousEmailAccountLinking: true
        })
    ],
    session: {
        strategy: "jwt",
        maxAge: 24 * 60 * 60,
        updateAge: 4 * 60 * 60
    },
    callbacks: {
        async jwt ({ token, user, account, profile, trigger }) {
            try {
                // Trường hợp đăng nhập - Chỉ cập nhật token khi có user từ đăng nhập
                if (user) {
                    // Đảm bảo role có thể null
                    token.role = user.role;
                    token.id = user.id;
                    return token;
                }
                // Trường hợp trigger update - Cập nhật token khi có sự thay đổi rõ ràng
                if (trigger === 'update' && token?.sub) {
                    try {
                        const dbUser = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.findUnique({
                            where: {
                                id: token.sub
                            },
                            select: {
                                id: true,
                                name: true,
                                email: true,
                                role: true,
                                image: true
                            }
                        });
                        if (dbUser) {
                            // Cập nhật token với giá trị mới
                            token.role = dbUser.role;
                            token.name = dbUser.name;
                            token.email = dbUser.email;
                            token.picture = dbUser.image;
                            // Thêm timestamp để đảm bảo không cache token cũ
                            token.updatedAt = Date.now();
                        }
                    } catch (error) {
                        console.error("Error updating token:", error);
                    }
                    return token;
                }
                // Trường hợp token từ session: kiểm tra nếu cần cập nhật
                if (token?.sub && (!token.role || !token.updatedAt || Date.now() - (token.updatedAt || 0) > 60 * 1000)) {
                    try {
                        const dbUser = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.findUnique({
                            where: {
                                id: token.sub
                            },
                            select: {
                                role: true
                            }
                        });
                        if (dbUser) {
                            token.role = dbUser.role;
                            token.updatedAt = Date.now();
                        }
                    } catch (error) {
                        console.error("Error refreshing token:", error);
                    }
                }
                return token;
            } catch (error) {
                console.error("JWT callback error:", error);
                return token;
            }
        },
        async session ({ session, token }) {
            try {
                if (session.user && token) {
                    // Đảm bảo role có thể null
                    session.user.role = token.role;
                    session.user.id = token.id;
                }
                return session;
            } catch (error) {
                console.error("Session callback error:", error);
                return session;
            }
        },
        async signIn ({ user, account, profile }) {
            // Nếu user có email
            if (user?.email) {
                try {
                    // Kiểm tra user đã tồn tại chưa
                    const existingUser = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.findUnique({
                        where: {
                            email: user.email
                        }
                    });
                    if (!existingUser) {
                        // Tạo user mới không có role (null) để người dùng chọn sau
                        await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.create({
                            data: {
                                id: user.id,
                                email: user.email,
                                name: user.name,
                                image: user.image,
                                role: null
                            }
                        });
                        // Đánh dấu để redirect tới trang chọn role
                        return true;
                    }
                    return true;
                } catch (error) {
                    return handleAuthError(error, "signIn callback");
                }
            }
            return true;
        }
    },
    pages: {
        signIn: '/auth/signin',
        signOut: '/',
        error: '/auth/error',
        newUser: '/auth/select-role' // Điều hướng người dùng mới đến trang chọn role
    },
    secret: process.env.NEXTAUTH_SECRET,
    debug: ("TURBOPACK compile-time value", "development") === "development",
    logger: {
        error (code, ...message) {
            console.error(`[NextAuth Error] ${code}:`, ...message);
        },
        warn (code, ...message) {
            if ("TURBOPACK compile-time truthy", 1) {
                console.warn(`[NextAuth Warning] ${code}:`, ...message);
            }
        },
        debug (code, ...message) {
            if ("TURBOPACK compile-time truthy", 1) {
                console.debug(`[NextAuth Debug] ${code}:`, ...message);
            }
        }
    }
};
const handler = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(authOptions);
;
}}),
"[project]/app/api/utils/api-types.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/**
 * HTTP Status Codes
 */ __turbopack_context__.s({
    "API_ERROR_CODES": (()=>API_ERROR_CODES),
    "API_MESSAGES": (()=>API_MESSAGES),
    "HTTP_STATUS": (()=>HTTP_STATUS)
});
const HTTP_STATUS = {
    OK: 200,
    CREATED: 201,
    BAD_REQUEST: 400,
    UNAUTHORIZED: 401,
    FORBIDDEN: 403,
    NOT_FOUND: 404,
    METHOD_NOT_ALLOWED: 405,
    CONFLICT: 409,
    INTERNAL_SERVER_ERROR: 500
};
const API_ERROR_CODES = {
    VALIDATION_ERROR: 'VALIDATION_ERROR',
    NOT_FOUND: 'NOT_FOUND',
    UNAUTHORIZED: 'UNAUTHORIZED',
    FORBIDDEN: 'FORBIDDEN',
    INTERNAL_ERROR: 'INTERNAL_ERROR'
};
const API_MESSAGES = {
    NOT_FOUND: {
        QUESTION: 'Question not found',
        OPTION: 'Option not found',
        QUIZ: 'Quiz not found',
        USER: 'User not found',
        ATTEMPT: 'Attempt not found',
        ANSWER: 'Answer not found'
    },
    UNAUTHORIZED: 'Unauthorized access',
    FORBIDDEN: 'Access forbidden',
    INTERNAL_ERROR: 'Internal server error',
    VALIDATION_ERROR: 'Validation error',
    ATTEMPT: {
        CREATED: 'Attempt created successfully',
        UPDATED: 'Attempt updated successfully',
        COMPLETED: 'Attempt completed successfully',
        DELETED: 'Attempt deleted successfully',
        MAX_ATTEMPTS_REACHED: 'Maximum attempts reached for this quiz',
        ALREADY_COMPLETED: 'This attempt is already completed',
        QUIZ_CLOSED: 'This quiz is no longer accepting submissions',
        INVALID_ANSWER: 'Invalid answer format',
        PARTIAL_SCORE: 'Some questions require manual grading'
    },
    ANALYTICS: {
        FORBIDDEN: 'You do not have permission to view this data',
        STUDENT_RESTRICTED: 'This data is only available to teachers'
    }
};
}}),
"[project]/app/api/utils/api-response.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "ApiError": (()=>ApiError),
    "createApiResponse": (()=>createApiResponse),
    "errorResponse": (()=>errorResponse),
    "forbiddenResponse": (()=>forbiddenResponse),
    "handleZodError": (()=>handleZodError),
    "notFoundResponse": (()=>notFoundResponse),
    "serverErrorResponse": (()=>serverErrorResponse),
    "successResponse": (()=>successResponse),
    "unauthorizedResponse": (()=>unauthorizedResponse),
    "validationErrorResponse": (()=>validationErrorResponse)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/api/utils/api-types.ts [app-route] (ecmascript)");
;
;
class ApiError extends Error {
    statusCode;
    code;
    details;
    constructor(statusCode, message, code, details){
        super(message);
        this.statusCode = statusCode;
        this.code = code || __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_ERROR_CODES"].INTERNAL_ERROR;
        this.details = details;
        this.name = 'ApiError';
    }
}
function createApiResponse(data, options) {
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
        success: true,
        data,
        ...options?.pagination && {
            meta: options.pagination
        }
    }, {
        status: options?.status || __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["HTTP_STATUS"].OK,
        headers: options?.cacheControl ? {
            'Cache-Control': options.cacheControl
        } : undefined
    });
}
function successResponse(data, options) {
    const response = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
        success: true,
        data,
        ...options?.pagination && {
            pagination: options.pagination
        }
    }, {
        status: options?.status || __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["HTTP_STATUS"].OK
    });
    // Set cache headers if provided
    if (options?.cacheControl) {
        response.headers.set("Cache-Control", options.cacheControl);
    }
    return response;
}
function errorResponse(message, options) {
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
        success: false,
        error: {
            message,
            code: options?.code || __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_ERROR_CODES"].INTERNAL_ERROR,
            ...options?.details && {
                details: options.details
            }
        }
    }, {
        status: options?.status || __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["HTTP_STATUS"].INTERNAL_SERVER_ERROR
    });
}
function unauthorizedResponse() {
    return errorResponse(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_MESSAGES"].UNAUTHORIZED, {
        status: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["HTTP_STATUS"].UNAUTHORIZED,
        code: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_ERROR_CODES"].UNAUTHORIZED
    });
}
function forbiddenResponse() {
    return errorResponse(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_MESSAGES"].FORBIDDEN, {
        status: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["HTTP_STATUS"].FORBIDDEN,
        code: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_ERROR_CODES"].FORBIDDEN
    });
}
function notFoundResponse(message) {
    return errorResponse(message, {
        status: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["HTTP_STATUS"].NOT_FOUND,
        code: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_ERROR_CODES"].NOT_FOUND
    });
}
function validationErrorResponse(details) {
    return errorResponse(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_MESSAGES"].VALIDATION_ERROR, {
        status: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["HTTP_STATUS"].BAD_REQUEST,
        code: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_ERROR_CODES"].VALIDATION_ERROR,
        details
    });
}
function handleZodError(error) {
    const details = error.errors.reduce((acc, err)=>{
        const path = err.path.join('.');
        acc[path] = err.message;
        return acc;
    }, {});
    return validationErrorResponse(details);
}
function serverErrorResponse(message = __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_MESSAGES"].INTERNAL_ERROR) {
    return errorResponse(message, {
        status: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["HTTP_STATUS"].INTERNAL_SERVER_ERROR,
        code: __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_ERROR_CODES"].INTERNAL_ERROR
    });
}
}}),
"[project]/app/api/users/me/upcoming-assessments/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>GET)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/api/auth/[...nextauth]/route.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/db.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$response$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/api/utils/api-response.ts [app-route] (ecmascript)");
;
;
;
;
;
;
async function GET() {
    try {
        // Verify user authentication
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
        if (!session?.user) {
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$response$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ApiError"](401, "Authentication required");
        }
        // Only students can access this API
        if (session.user.role !== __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["Role"].STUDENT) {
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$response$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ApiError"](403, "Access denied: Student role required");
        }
        const userId = session.user.id;
        const now = new Date();
        // Get upcoming assessments for the next 7 days
        const sevenDaysFromNow = new Date();
        sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7);
        // Find classes the student is enrolled in
        const enrolledClasses = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].classEnrollment.findMany({
            where: {
                studentId: userId
            },
            select: {
                classId: true
            }
        });
        const classIds = enrolledClasses.map((enrollment)=>enrollment.classId);
        // Get quizzes from those classes that are scheduled for the next 7 days
        const upcomingAssessments = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].quiz.findMany({
            where: {
                classId: {
                    in: classIds
                },
                // Published quizzes that haven't been attempted by this student
                isPublished: true,
                startDate: {
                    gte: now,
                    lte: sevenDaysFromNow
                },
                // Exclude quizzes that the student has already attempted
                NOT: {
                    attempts: {
                        some: {
                            userId: userId
                        }
                    }
                }
            },
            select: {
                id: true,
                title: true,
                description: true,
                startDate: true,
                endDate: true,
                timeLimit: true,
                class: {
                    select: {
                        id: true,
                        name: true
                    }
                },
                _count: {
                    select: {
                        questions: true
                    }
                }
            },
            orderBy: {
                startDate: 'asc'
            }
        });
        // Trả về mảng trống thay vì dữ liệu mẫu khi không tìm thấy kết quả
        if (upcomingAssessments.length === 0) {
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$response$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createApiResponse"])([]);
        }
        // Return the result
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$response$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createApiResponse"])(upcomingAssessments);
    } catch (error) {
        if (error instanceof __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$api$2f$utils$2f$api$2d$response$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ApiError"]) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: error.message
            }, {
                status: error.statusCode
            });
        }
        console.error("Error fetching upcoming assessments:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: "Internal server error"
        }, {
            status: 500
        });
    }
}
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__ee8525b8._.js.map